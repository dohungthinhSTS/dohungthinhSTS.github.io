<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>Rediscovering Ruby - Embrace New Features for Optimal Performance</title><meta name="description" content="The only limit is the one you set for yourself."><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="





Rediscovering Ruby: Embrace New Features for Optimal PerformanceRuby is constantly evolving, and staying updated with its latest features can make a significant difference in your coding efficiency. If you’re still using Ruby 1.9.2 techniques in the Ruby 3.3 era, it’s time to refresh your skills and embrace the new enhancements.
Many developers tend .."><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">dohungthinhtin's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Rediscovering Ruby - Embrace New Features for Optimal Performan..</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Rediscovering-Ruby-Embrace-New-Features-for-Optimal-Performance"><span class="toc-text">Rediscovering Ruby: Embrace New Features for Optimal Performance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RBS-Ruby-Signature"><span class="toc-text">RBS (Ruby Signature)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pattern-Matching"><span class="toc-text">Pattern Matching</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example"><span class="toc-text">Example:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#One-Line-Pattern-Matching"><span class="toc-text">One-Line Pattern Matching</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rightward-Assignment"><span class="toc-text">Rightward Assignment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Refinements"><span class="toc-text">Refinements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerator-Lazy"><span class="toc-text">Enumerator::Lazy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Enumerator-Chain"><span class="toc-text">Enumerator::Chain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Module-prepend"><span class="toc-text">Module#prepend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#End-less-Method-Definition"><span class="toc-text">End-less Method Definition</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#it-Parameter"><span class="toc-text">it Parameter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#String-casecmp"><span class="toc-text">String#casecmp?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object-yield-self-and-then"><span class="toc-text">Object#yield_self and then</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Ruby"><i class="tag post-item-tag">Ruby</i></a><a href="/tags/Programming"><i class="tag post-item-tag">Programming</i></a><a href="/tags/DevOps"><i class="tag post-item-tag">DevOps</i></a><a href="/tags/Software%20Development"><i class="tag post-item-tag">Software Development</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Rediscovering Ruby - Embrace New Features for Optimal Performance</h1><time class="has-text-grey" datetime="2024-01-03T05:00:00.000Z">2024-01-03</time><article class="mt-2 post-content"><center>
<img src="/2024/01/03/ruby-3-updated/ruby_avatar.png" class="" title="ruby_avatar">
</center>

<br>

<h2 id="Rediscovering-Ruby-Embrace-New-Features-for-Optimal-Performance"><a href="#Rediscovering-Ruby-Embrace-New-Features-for-Optimal-Performance" class="headerlink" title="Rediscovering Ruby: Embrace New Features for Optimal Performance"></a>Rediscovering Ruby: Embrace New Features for Optimal Performance</h2><p>Ruby is constantly evolving, and staying updated with its latest features can make a significant difference in your coding efficiency. If you’re still using Ruby 1.9.2 techniques in the Ruby 3.3 era, it’s time to refresh your skills and embrace the new enhancements.</p>
<p>Many developers tend to stick to the familiar, old methods, missing out on the benefits of the latest updates. Embracing new features is crucial to maintaining Ruby’s relevance and efficiency in the modern programming landscape.</p>
<h2 id="RBS-Ruby-Signature"><a href="#RBS-Ruby-Signature" class="headerlink" title="RBS (Ruby Signature)"></a>RBS (Ruby Signature)</h2><p>Traditionally, ensuring type safety in Ruby required extensive testing and documentation, which could be time-consuming and error-prone.</p>
<p>RBS, introduced with Ruby 3.1, is a new language designed to describe the types and interfaces of Ruby code. It allows for static type checking and IDE autocompletion, enhancing code quality and developer productivity.</p>
<p>While alternatives like Sorbet exist, RBS is officially supported by Matz, making it the standard for type checking in Ruby.</p>
<pre><code class="ruby"># Point.rbs
class Point
  attr_reader x: Integer
  attr_reader y: Integer

  def initialize: (x: Integer, y: Integer) -&gt; void
end

# Point.rb
class Point
  attr_reader :x, :y

  def initialize(x, y)
    @x = x
    @y = y
  end
end
</code></pre>
<p>Steep, a static type checker for Ruby, can be integrated into CI&#x2F;CD pipelines to ensure type safety and catch errors early.</p>
<p>Here’s how to configure Steep in a GitHub Actions CI&#x2F;CD pipeline:</p>
<pre><code class="yaml"># .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Setup Ruby
        uses: actions/setup-ruby@v1
        with:
          ruby-version: &#39;3.3&#39;

      - name: Install dependencies
        run: bundle install

      - name: Run Steep
        run: bundle exec steep check
</code></pre>
<p>Integrating Steep into your CI&#x2F;CD pipeline helps maintain code quality by enforcing type safety and preventing runtime errors. This promotes best practices and enhances the reliability of Ruby applications.</p>
<p>However, adopting RBS might require a significant investment in learning and setting up the necessary tools, and maintaining type annotations can add overhead.</p>
<h2 id="Pattern-Matching"><a href="#Pattern-Matching" class="headerlink" title="Pattern Matching"></a>Pattern Matching</h2><p>Pattern matching, a highly anticipated feature, was introduced in Ruby 2.7 and further enhanced in Ruby 3.0. Matz wanted to include pattern matching to make Ruby more expressive and align it with modern programming languages.</p>
<p>Before pattern matching, handling complex data structures required verbose code, making it harder to maintain.</p>
<p>Pattern matching allows for concise and expressive destructuring and matching of data, improving code readability and maintainability.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example:"></a>Example:</h3><pre><code class="ruby">def company_location_contact_id(company_location_id)
  query = &lt;&lt;~GRAPHQL
    query($company_location_id: ID!) &#123;
      companyLocation(id: $company_location_id) &#123;
        ...
      &#125;
    &#125;
  GRAPHQL

  response = @client.query(
    query:,
    variables: &#123; company_location_id: &quot;gid://shopify/CompanyLocation/#&#123;company_location_id&#125;&quot; &#125;
  ).body

  case response.deep_symbolize_keys
  in errors: [&#123; message: error_message &#125;]
    Rollbar.error(&quot;#&#123;error_message&#125; for&quot;, company_location_id:)
  in data: &#123; companyLocation: nil &#125;
    Rollbar.error(&quot;Company location not found&quot;, company_location_id:)
  in data: &#123; companyLocation: &#123; roleAssignments: &#123; edges: [&#123; node: &#123; companyContact: &#123; id: contact_id &#125; &#125; &#125;] &#125; &#125; &#125;
    contact_id
  end
end
</code></pre>
<p>Without pattern matching, the code becomes verbose and error-prone, involving nested conditionals or manual parsing of the response data.</p>
<h2 id="One-Line-Pattern-Matching"><a href="#One-Line-Pattern-Matching" class="headerlink" title="One-Line Pattern Matching"></a>One-Line Pattern Matching</h2><p>Destructuring hashes or arrays often required multiple lines of code. One-line pattern matching, introduced in Ruby 2.7, simplifies this by allowing destructuring in a single line.</p>
<pre><code class="ruby">data = &#123; user: &#123; name: &quot;Alice&quot;, details: &#123; age: 25, city: &quot;Paris&quot; &#125; &#125; &#125;
data =&gt; &#123; user: &#123; name:, details: &#123; age:, city: &#125; &#125; &#125;
puts &quot;Name: #&#123;name&#125;, Age: #&#123;age&#125;, City: #&#123;city&#125;&quot;
</code></pre>
<p>While concise, the one-line syntax may be less readable for complex patterns, requiring familiarity with the new syntax.</p>
<h2 id="Rightward-Assignment"><a href="#Rightward-Assignment" class="headerlink" title="Rightward Assignment"></a>Rightward Assignment</h2><p>Rightward assignment, introduced in Ruby 3.0, simplifies syntax by allowing assignments in a more readable manner.</p>
<pre><code class="ruby">read_data() =&gt; user_data =&gt; &#123; user: &#123; name:, details: &#123; age:, city: &#125; &#125; &#125;
save!(user_data)
puts &quot;Name: #&#123;name&#125;, City: #&#123;city&#125;&quot;
</code></pre>
<p>This syntax, though more natural in flow, might be unfamiliar and potentially confusing if overused in complex expressions.</p>
<h2 id="Refinements"><a href="#Refinements" class="headerlink" title="Refinements"></a>Refinements</h2><p>Global modifications to core classes could lead to conflicts. Refinements, introduced in Ruby 2.0, allow scoped modifications, reducing side effects.</p>
<pre><code class="ruby">module ArrayExtensions
  refine Array do
    def to_hash
      Hash[*self.flatten]
    end
  end
end

class Converter
  using ArrayExtensions

  def self.convert(array)
    array.to_hash
  end
end

puts Converter.convert([[:key1, &quot;value1&quot;], [:key2, &quot;value2&quot;]])
</code></pre>
<p>Refinements are powerful but can lead to unexpected behavior if not active in the expected context.</p>
<h2 id="Enumerator-Lazy"><a href="#Enumerator-Lazy" class="headerlink" title="Enumerator::Lazy"></a>Enumerator::Lazy</h2><p>Handling large collections efficiently is crucial. Lazy enumerators, introduced in Ruby 2.0, enable efficient chaining without creating intermediate arrays.</p>
<pre><code class="ruby">lazy_numbers = (1..Float::INFINITY).lazy
result = lazy_numbers.select &#123; |n| n % 2 == 0 &#125;
                     .map &#123; |n| n * n &#125;
                     .take(10)
                     .to_a

puts result.inspect
</code></pre>
<p>While improving performance, lazy enumerators can complicate debugging due to deferred operations.</p>
<h2 id="Enumerator-Chain"><a href="#Enumerator-Chain" class="headerlink" title="Enumerator::Chain"></a>Enumerator::Chain</h2><p>Chaining multiple enumerables was less expressive. Enumerator::Chain, introduced in Ruby 2.6, simplifies this, enhancing readability.</p>
<pre><code class="ruby">evens = (2..10).step(2)
odds = (1..9).step(2)
combined = evens.each.chain(odds.each)

puts combined.to_a.inspect
</code></pre>
<p>Though it simplifies chaining, it introduces another concept for developers to learn.</p>
<h2 id="Module-prepend"><a href="#Module-prepend" class="headerlink" title="Module#prepend"></a>Module#prepend</h2><p>Using include to mix in modules could make method overrides complex. Module#prepend, introduced in Ruby 2.0, provides a more predictable method override mechanism.</p>
<pre><code class="ruby">module Logging
  def process
    puts &quot;Logging before processing&quot;
    super
    puts &quot;Logging after processing&quot;
  end
end

class DataProcessor
  def process
    puts &quot;Processing data&quot;
  end
end

class CustomProcessor &lt; DataProcessor
  prepend Logging
end

processor = CustomProcessor.new
processor.process
</code></pre>
<p>Prepend can complicate the method lookup chain, requiring a clear understanding of include and prepend differences.</p>
<h2 id="End-less-Method-Definition"><a href="#End-less-Method-Definition" class="headerlink" title="End-less Method Definition"></a>End-less Method Definition</h2><p>Defining simple methods required multiple lines. Endless method definitions, introduced in Ruby 3.0, provide a concise syntax for single-expression methods.</p>
<pre><code class="ruby">class Calculator
  def add(a, b) = a + b
  def multiply(a, b) = a * b
  def power(base, exponent) = base**exponent
end

calc = Calculator.new
puts calc.add(2, 3)       # Output: 5
puts calc.multiply(4, 5)  # Output: 20
puts calc.power(2, 3)     # Output: 8
</code></pre>
<p>This new syntax, while reducing boilerplate, might be less familiar and potentially reduce readability if overused.</p>
<h2 id="it-Parameter"><a href="#it-Parameter" class="headerlink" title="it Parameter"></a><code>it</code> Parameter</h2><p>Using explicit block variables could be verbose for simple operations. The <code>it</code> parameter, introduced in Ruby 3.0, simplifies block syntax.</p>
<pre><code class="ruby">[&quot;apple&quot;, &quot;banana&quot;, &quot;cherry&quot;].map &#123; it.upcase.reverse &#125;
</code></pre>
<p>This parameter can make code less readable for complex operations, introducing a new convention for developers to learn.</p>
<h2 id="String-casecmp"><a href="#String-casecmp" class="headerlink" title="String#casecmp?"></a>String#casecmp?</h2><p>Case-insensitive string comparison was verbose. String#casecmp?, introduced in Ruby 2.4, simplifies this operation.</p>
<pre><code class="ruby">strings = [&quot;Hello&quot;, &quot;world&quot;, &quot;HELLO&quot;]
matches = strings.select &#123; |s| s.casecmp?(&quot;hello&quot;) &#125;
puts matches.inspect # =&gt; [&quot;Hello&quot;, &quot;HELLO&quot;]
</code></pre>
<h2 id="Object-yield-self-and-then"><a href="#Object-yield-self-and-then" class="headerlink" title="Object#yield_self and then"></a>Object#yield_self and then</h2><p>Chaining operations on an object could be verbose. Object#yield_self and its alias then improve readability and fluidity.</p>
<pre><code class="ruby">result = &quot;hello&quot;
         .yield_self &#123; |str| str.upcase &#125;
         .then &#123; |str| str + &quot; WORLD&quot; &#125;
</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><em></em><a class="button is-default" href="/2024/01/02/efficiency_in_ruby/" title="Enhancing Performance in Ruby On Rails - Method Comparisons"><span class="has-text-weight-semibold">Next: Enhancing Performance in Ruby On Rails - Method Comparisons</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/dohungthinhSTS"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com/thinhdohung/"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><a title="linkedin" target="_blank" rel="noopener nofollow" href="//www.linkedin.com/in/thinh-hung-a74943132/"><i class="iconfont icon-linkedin"></i></a><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com/thinh.dohung/"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> dohungthinhtin 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"></p></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>